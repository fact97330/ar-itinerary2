<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>ARしおり（MindAR）</title>
  <!-- A-Frame & MindAR (CDN) -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <style>
    body, html { margin:0; padding:0; overflow:hidden; background:#000; }
    .hint {
      position: fixed; top: 0; left: 0; right: 0;
      color: #fff; background: rgba(0,0,0,.35); padding: 8px 12px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans JP', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
      font-size: 14px; text-align: center; z-index: 2;
    }
  </style>
</head>
<body>
  <div class="hint">カメラを許可し、A4の「偽しおり」を画面に入れてください</div>

  <a-scene
    mindar-image="imageTargetSrc: targets.mind; autoStart: true; uiScanning: true; uiLoading: true;"
    renderer="colorManagement: true, physicallyCorrectLights: true"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false">
    
    <a-assets>
      <!-- 本物のしおり画像（差し替え推奨） -->
      <img id="realTrip" src="assets/real-itinerary.jpg">
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <!-- マーカー（targetIndex:0）が見つかったとき、このエンティティ以下が表示される -->
    <a-entity mindar-image-target="targetIndex: 0">
      <!-- 画像のアスペクト比に合わせて width/height を JS で設定します -->
      <a-plane id="overlay" src="#realTrip"
               position="0 0 0" rotation="0 0 0"
               material="transparent: true; opacity: 1.0">
      </a-plane>
    </a-entity>
  </a-scene>

  <script>
    // 読み込んだ画像の縦横比に合わせて、オーバーレイ平面の幅/高さを設定します。
    // 幅=1 を基準にし、高さ = 1 * (画像高さ/画像幅)
    (function() {
      var img = document.getElementById('realTrip');
      var plane = document.getElementById('overlay');
      var setSize = function() {
        if (img.naturalWidth && img.naturalHeight) {
          var ratio = img.naturalHeight / img.naturalWidth;
          plane.setAttribute('width', 1);
          plane.setAttribute('height', 1 * ratio);
        }
      };
      if (img.complete) setSize();
      img.addEventListener('load', setSize);
    })();

    // targets.mind が存在しないときにヒントを出す（簡易チェック）
    fetch('targets.mind', {method: 'HEAD'}).then(function(res){
      if (!res.ok) { alert('targets.mind が見つかりません。MindARのImage Compilerで作成し、このindex.htmlと同じフォルダに置いてください。'); }
    }).catch(function(){ /* ignore */ });
  </script>
</body>
</html>
